#!/bin/bash

todo=$(todo.sh)
root="/home/carnager/Documents/todo"
export EDITOR="gvim -f"
BROWSER="chromium"

main () {
tasklist=$(todo.sh ls | rofi -dmenu -kb-custom-1 "Alt+o" -kb-custom-2 "Alt+a" -mesg "Alt+o: Open URL | Alt+a: Actions" -p "Tasklist > ")

val=$?
item=$(echo "${tasklist}" | awk '{ print $1 }')

if [[ $val -eq 10 ]]
    then url="$(todo.sh note show ${item})"
    if [[ $url == *"has no note." ]]; then
        errormenu=$(echo -e "< Return\n1. Add URL to item" | rofi -dmenu -auto-select -mesg "${url}")
        if [[ $errormenu == "< Return" ]]
        then main
        elif [[ $errormenu == "1. Add URL to item" ]]
        then todo.sh append "${item}" "note:${item}.txt"
            urlinput=$(echo "" | rofi -dmenu -mesg "Enter URL" -p "> ")
            if [[ $urlinput == "" ]]; then exit
            else echo "${urlinput}" > "${root}/notes/${item}.txt"
            fi
        fi
    else $BROWSER "$(todo.sh note show ${item})"
    fi

elif [[ $val -eq 11 ]]
    then actions
fi
}

actions () {
    actionlist=$(echo -e "1. Mark Done\n2. Archive\n3. Delete" | rofi -dmenu -p "Actions for item ${item} > ")

    if [[ $actionlist == "1. Mark Done" ]]; then
        todo.sh 'do' "${item}"

    elif [[ $actionlist == "2. Archive" ]]; then
        todo.sh archive "${item}"

    elif [[ $actionlist == "3. Delete" ]]; then
        askmenu=$(echo -e "1. Yes\n2. No" | rofi -dmenu -p "Delete item ${item}? > ")
        if [[ $askmenu == "1. Yes" ]]; then
            yes | todo.sh del "${item}";
            main
        elif [[ $askmenu == "2. No" ]]; then
            main
        fi
    fi
}

main
